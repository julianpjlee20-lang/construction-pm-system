# 工程專案管理系統 - 前端使用說明

## 🚀 快速啟動

### 1. 安裝依賴
```bash
cd /home/ubuntu/.openclaw/workspace/notes/向上建設/工程專案管理系統/src/frontend
npm install
```

### 2. 啟動開發伺服器
```bash
npm run dev
```

前端會自動啟動在 **http://localhost:5173/** （或其他可用 port）

### 3. 確保後端運行
後端 API 應運行在 **http://localhost:8096**

檢查後端狀態：
```bash
curl http://localhost:8096/api/tasks
```

---

## 📋 功能說明

### 1️⃣ **任務看板（Kanban）**
- **三欄式拖拉看板**：待辦 / 進行中 / 已完成
- **拖拉操作**：直接拖動卡片到不同欄位來更新狀態
- **即時更新**：拖拉後自動同步到後端 API
- **任務資訊**：顯示任務名稱、負責人、進度百分比

**操作方式**：
1. 點擊任務卡片 → 查看詳細資訊
2. 拖拉卡片到其他欄位 → 更新任務狀態

---

### 2️⃣ **甘特圖（Gantt Chart）**
- **雙軌進度顯示**：
  - **灰色底線** → 預計時程（plannedStartDate ~ plannedEndDate）
  - **彩色進度條** → 實際進度（actualStartDate ~ actualEndDate）
- **進度警示顏色**：
  - 🟢 **綠色** → 已完成
  - 🔵 **藍色** → 正常進度（無延遲）
  - 🟡 **黃色** → 輕微延遲（< 20%）
  - 🔴 **紅色** → 嚴重延遲（≥ 20%）
- **依賴關係**：箭頭顯示任務相依性
- **互動操作**：點擊任務條 → 開啟詳情頁

**計算邏輯**：
```
延遲率 = (實際天數 - 預計天數) / 預計天數 × 100%
```

---

### 3️⃣ **照片管理**
- **拖拉上傳**：將照片拖放到上傳區域
- **自動壓縮**：上傳前自動壓縮至 **最大 2MB**
- **支援格式**：JPG, PNG, GIF
- **時間軸顯示**：照片由新到舊排序
- **照片資訊**：
  - 上傳時間（精確到分鐘）
  - 上傳者
  - 照片描述
  - 查看原圖連結

**操作流程**：
1. 切換到「照片」分頁
2. 選擇任務（下拉選單）
3. 拖放照片或點擊上傳
4. 等待壓縮 + 上傳（進度條顯示）
5. 照片出現在時間軸中

---

## 🔧 技術架構

### 核心技術棧
- **React 18** - UI 框架
- **Vite 5** - 構建工具
- **TailwindCSS 3** - 樣式框架
- **Zustand** - 狀態管理
- **Axios** - HTTP 客戶端

### 關鍵套件
- **@dnd-kit/core** - 拖拉功能（Kanban）
- **frappe-gantt** - 甘特圖元件
- **react-dropzone** - 照片上傳（拖放介面）
- **browser-image-compression** - 照片壓縮（前端壓縮）

---

## 📡 API 整合

### 後端端點（Base URL: `http://localhost:8096/api`）

#### 1. 取得所有任務
```http
GET /tasks
```
**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "task-001",
      "name": "鋼筋綁紮",
      "status": "進行中",
      "progress": 75,
      ...
    }
  ]
}
```

#### 2. 建立任務
```http
POST /tasks
Content-Type: application/json

{
  "name": "新任務",
  "description": "任務描述",
  "assignee": "負責人",
  ...
}
```

#### 3. 更新任務
```http
PUT /tasks/:id
Content-Type: application/json

{
  "status": "已完成",
  "progress": 100
}
```

#### 4. 上傳照片
```http
POST /tasks/:id/photos
Content-Type: multipart/form-data

{
  "photo": <file>,
  "description": "照片描述",
  "uploadedBy": "上傳者"
}
```

---

## 🎨 RWD（響應式設計）

### 斷點設計
- **手機版**（< 768px）：
  - 看板垂直排列（單欄）
  - 導航列按鈕橫向滾動
  - 甘特圖字體縮小
  
- **桌面版**（≥ 768px）：
  - 看板三欄並排
  - 導航列按鈕水平排列
  - 甘特圖完整顯示

### 測試方式
1. 瀏覽器開發者工具（F12）
2. 切換至「裝置模擬」
3. 測試 iPhone / iPad / Desktop

---

## 🛡️ 錯誤處理

### 後端未啟動
- **自動降級**：使用 Mock 資料（3 個範例任務）
- **Console 警告**：`⚠️ 後端未啟動，使用 Mock 資料`
- **功能正常**：拖拉、更新等操作在本地狀態有效

### 網路錯誤
- **照片上傳失敗**：顯示本地預覽（不儲存到後端）
- **任務更新失敗**：仍更新前端狀態（本地生效）

---

## 🐛 除錯技巧

### 查看 API 請求
```javascript
// 打開瀏覽器 Console（F12）
// 所有 API 錯誤會自動 log
```

### 檢查後端連線
```bash
# 測試後端是否運行
curl http://localhost:8096/api/tasks

# 查看後端日誌
cd /home/ubuntu/.openclaw/workspace/notes/向上建設/工程專案管理系統/src/backend
npm run dev
```

### 清除本地狀態
```javascript
// 在 Console 執行
localStorage.clear();
location.reload();
```

---

## 📦 建置生產版本

```bash
# 建置
npm run build

# 預覽
npm run preview
```

生產檔案會輸出到 `dist/` 目錄。

---

## 🔄 開發流程

### 1. 修改元件
- 元件位置：`src/components/`
- 主要元件：`Kanban.jsx`, `GanttChart.jsx`, `PhotoUpload.jsx`

### 2. 修改狀態管理
- Store 位置：`src/store/useTaskStore.js`
- 包含所有 API 呼叫邏輯

### 3. 修改樣式
- TailwindCSS：直接在 JSX 中使用 `className`
- 甘特圖樣式：`gantt-styles.css`
- 全域樣式：`index.css`

---

## ⚠️ 已知問題

1. **甘特圖時間軸**：如果任務時間跨度很大，可能需要手動調整 `view_mode`
2. **照片預覽**：本地壓縮後的照片不會上傳到 Google Drive（需後端實作）
3. **使用者系統**：目前「上傳者」欄位固定為「當前用戶」（待實作登入功能）

---

## 📞 支援

如遇問題，請檢查：
1. 後端是否運行（port 8096）
2. 瀏覽器 Console 是否有錯誤訊息
3. 網路連線是否正常

**技術文件位置**：
- `/home/ubuntu/.openclaw/workspace/notes/向上建設/工程專案管理系統/src/frontend/README.md`
- `/home/ubuntu/.openclaw/workspace/notes/向上建設/工程專案管理系統/src/README-FRONTEND.md`
